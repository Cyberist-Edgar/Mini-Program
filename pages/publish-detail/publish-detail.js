(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/publish-detail/publish-detail"],{"792c":function(t,e,n){"use strict";var o={uTopTips:function(){return n.e("uview-ui/components/u-top-tips/u-top-tips").then(n.bind(null,"e8af"))},uAvatar:function(){return n.e("uview-ui/components/u-avatar/u-avatar").then(n.bind(null,"0691"))},uGap:function(){return n.e("uview-ui/components/u-gap/u-gap").then(n.bind(null,"83e5"))},uRow:function(){return n.e("uview-ui/components/u-row/u-row").then(n.bind(null,"7d41"))},uCol:function(){return n.e("uview-ui/components/u-col/u-col").then(n.bind(null,"8fa9"))},uModal:function(){return n.e("uview-ui/components/u-modal/u-modal").then(n.bind(null,"2c34"))}},r=function(){var t=this,e=t.$createElement,n=(t._self._c,t._f("dateFormat")(t.data.date));t.$mp.data=Object.assign({},{$root:{f0:n}})},i=[];n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}))},"8b05":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("4795")),r=n("2f62");function i(t){return t&&t.__esModule?t:{default:t}}function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e,n,o,r,i,u){try{var a=t[i](u),c=a.value}catch(s){return void n(s)}a.done?e(c):Promise.resolve(c).then(o,r)}function l(t){return function(){var e=this,n=arguments;return new Promise((function(o,r){var i=t.apply(e,n);function u(t){s(i,o,r,u,a,"next",t)}function a(t){s(i,o,r,u,a,"throw",t)}u(void 0)}))}}var f={data:function(){return{id:"",data:{},page:0,content:"",show:!1,show_content:!1,info:"请先登录",comment_data:[]}},filters:{dateFormat:function(t){return t=new Date(t),[t.getFullYear(),t.getMonth()+1,t.getDate()].join("-")+" "+[t.getHours(),t.getMinutes()].join(":")}},onLoad:function(t){var e=this;this.id=t.id,wx.showLoading({title:"加载中"}),this.setPublishData(t.id).then((function(t){e.data=t.data,console.log(t),e.setComments().then((function(t){e.comment_data=t.data,console.log(t),wx.hideLoading(),e.show_content=!0}))}))},methods:{setPublishData:function(){var t=this;return new Promise((function(e,n){var o=wx.cloud.database({env:"edgar"});o.collection("publish").doc(t.id).get().then((function(t){e(t)})).catch((function(t){n(t)}))}))},submit:function(){var t=this;if(this.isLogin)if(""===this.content)this.$refs.uTips.show({title:"内容不能为空",type:"error"});else{var e={nickname:this.userInfo.nickName,avatarUrl:this.userInfo.avatarUrl,comment:this.content,date:new Date,publish_id:this.id};this.comment_data.push(e),this.content="";var n=wx.cloud.database({env:"edgar"});n.collection("comments").add({data:e}).catch((function(){t.$refs.uTips.show({title:"评论失败，请稍后重试",type:"error"})}))}else this.show=!0},confirm:function(){t.switchTab({url:"/pages/mine/mine"})},cancel:function(){this.show=!1},setComments:function(){var t=this;return l(o.default.mark((function e(){var n,r,i,u,a,c,s,l;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=wx.cloud.database({env:"edgar"}),r=20,e.next=4,n.collection("comments").where({publish_id:t.id}).count();case 4:if(i=e.sent,u=i.total,0!==u){e.next=8;break}return e.abrupt("return",new Promise((function(t){t([])})));case 8:for(a=Math.ceil(u/r),c=[],s=0;s<a;s++)console.log("index: ",s),l=n.collection("comments").orderBy("date","asc").where({publish_id:t.id}).skip(s*r).limit(r).get(),c.push(l);return e.next=13,Promise.all(c);case 13:return e.abrupt("return",e.sent.reduce((function(t,e){return{data:t.data.concat(e.data),errMsg:t.errMsg}})));case 14:case"end":return e.stop()}}),e)})))()}},computed:a({},(0,r.mapState)(["isLogin","userInfo"]))};e.default=f}).call(this,n("543d")["default"])},"8c14":function(t,e,n){"use strict";n.r(e);var o=n("8b05"),r=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=r.a},9649:function(t,e,n){},9766:function(t,e,n){"use strict";var o=n("9649"),r=n.n(o);r.a},"9cd4":function(t,e,n){"use strict";n.r(e);var o=n("792c"),r=n("8c14");for(var i in r)"default"!==i&&function(t){n.d(e,t,(function(){return r[t]}))}(i);n("9766");var u,a=n("f0c5"),c=Object(a["a"])(r["default"],o["b"],o["c"],!1,null,"be118f30",null,!1,o["a"],u);e["default"]=c.exports},eac8:function(t,e,n){"use strict";(function(t){n("c000");o(n("66fd"));var e=o(n("9cd4"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])}},[["eac8","common/runtime","common/vendor"]]]);